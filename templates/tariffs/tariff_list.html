{% extends 'base.html' %}
{% block title %}Тарифы{% endblock %}
{% block content %}
<div class="max-w-screen-xl mx-auto px-4 py-8 space-y-6">
    <div class="flex flex-col gap-2 animate-card">
        <p class="text-sm uppercase tracking-[0.2em] text-primary-500">Каталог тарифов</p>
        <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
            <h1 class="text-3xl font-bold text-gray-900">Тарифы</h1>
            <a href="{% url 'tariff_create' %}" class="inline-flex items-center rounded-2xl px-4 py-2 text-sm font-semibold text-white btn-gradient hover-lift-sm">
                + Добавить тариф
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 gap-4 sm:grid-cols-4">
        <div class="glass-panel p-4 animate-card">
            <p class="text-sm text-gray-500">Всего</p>
            <p class="text-3xl font-bold">{{ total_count }}</p>
        </div>
        <div class="glass-panel p-4 animate-card animate-delay-1">
            <p class="text-sm text-gray-500">Активных</p>
            <p class="text-3xl font-bold text-green-600">{{ active_count }}</p>
        </div>
        <div class="glass-panel p-4 animate-card animate-delay-2">
            <p class="text-sm text-gray-500">Prepaid</p>
            <p class="text-3xl font-bold text-blue-600">{{ prepaid_count }}</p>
        </div>
        <div class="glass-panel p-4 animate-card animate-delay-3">
            <p class="text-sm text-gray-500">Postpaid</p>
            <p class="text-3xl font-bold text-purple-600">{{ postpaid_count }}</p>
        </div>
    </div>

    <div class="glass-panel p-6 form-shell animate-card">
        <form method="get" class="grid grid-cols-1 gap-4 sm:grid-cols-4">
            <div>
                <label class="text-sm font-medium text-gray-700">Поиск</label>
                <input type="text" name="search" value="{{ current_search }}" placeholder="Название или код тарифа">
            </div>
            <div>
                <label class="text-sm font-medium text-gray-700">Статус</label>
                <select name="is_active">
                    <option value="">Все</option>
                    <option value="yes" {% if current_is_active == 'yes' %}selected{% endif %}>Активные</option>
                    <option value="no" {% if current_is_active == 'no' %}selected{% endif %}>Архивные</option>
                </select>
            </div>
            <div>
                <label class="text-sm font-medium text-gray-700">Тип</label>
                <select name="type">
                    <option value="">Все типы</option>
                    <option value="prepaid" {% if current_type == 'prepaid' %}selected{% endif %}>Prepaid</option>
                    <option value="postpaid" {% if current_type == 'postpaid' %}selected{% endif %}>Postpaid</option>
                </select>
            </div>
            <div class="flex items-end gap-2">
                {% if current_search or current_is_active or current_type %}
                <a href="{% url 'tariff_list' %}" class="rounded-2xl border border-gray-200 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50">Сбросить</a>
                {% endif %}
                <button type="submit" class="rounded-2xl px-4 py-2 text-sm font-semibold text-white btn-gradient">Применить</button>
            </div>
        </form>
    </div>

    <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
        {% for tariff in tariffs %}
        <div class="glass-panel p-6 space-y-4 animate-card hover-lift">
            <div class="flex items-start justify-between">
                <div>
                    <p class="text-xs uppercase tracking-[0.3em] text-gray-400">{{ tariff.get_type_display }}</p>
                    <h3 class="text-xl font-bold text-gray-900">{{ tariff.name }}</h3>
                </div>
                {% if tariff.is_active %}
                <span class="tag-soft bg-emerald-100 text-emerald-700">Активен</span>
                {% else %}
                <span class="tag-soft bg-gray-100 text-gray-700">Архив</span>
                {% endif %}
            </div>
            <p class="text-gray-600 text-sm">{{ tariff.description|truncatewords:20|default:"Описание не указано" }}</p>
            <div class="grid grid-cols-2 gap-3 text-sm text-gray-600">
                <p class="flex justify-between"><span>Абонплата</span><span class="font-semibold text-gray-900">{{ tariff.monthly_fee }} с</span></p>
                <p class="flex justify-between"><span>Минуты</span><span>{{ tariff.minutes_included|default:"∞" }}</span></p>
                <p class="flex justify-between"><span>SMS</span><span>{{ tariff.sms_included|default:"∞" }}</span></p>
                <p class="flex justify-between"><span>Интернет</span><span>{{ tariff.data_gb_included|default:"∞" }} ГБ</span></p>
            </div>
            <div class="flex gap-2">
                <a href="{% url 'tariff_detail' tariff.id %}" class="flex-1 rounded-2xl border border-gray-200 px-3 py-2 text-center text-sm text-gray-700 hover:bg-gray-50">Подробнее</a>
                <a href="{% url 'tariff_edit' tariff.id %}" class="flex-1 rounded-2xl bg-primary-50 px-3 py-2 text-center text-sm font-semibold text-primary-600 hover:bg-primary-100">Редактировать</a>
            </div>
        </div>
        {% empty %}
        <div class="col-span-3 glass-panel p-12 text-center text-gray-500">Тарифы не найдены</div>
        {% endfor %}
    </div>

    {% if is_paginated %}
    <div class="glass-panel px-4 py-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between animate-card">
        <p class="text-sm text-gray-500">Страница {{ page_obj.number }} из {{ paginator.num_pages }} · всего {{ paginator.count }}</p>
        <div class="flex gap-2">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if current_search %}&search={{ current_search }}{% endif %}{% if current_is_active %}&is_active={{ current_is_active }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}" class="rounded-2xl border border-gray-200 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Назад</a>
            {% else %}
            <span class="rounded-2xl border border-gray-100 px-4 py-2 text-sm text-gray-300">Назад</span>
            {% endif %}
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if current_search %}&search={{ current_search }}{% endif %}{% if current_is_active %}&is_active={{ current_is_active }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}" class="rounded-2xl border border-gray-200 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Вперёд</a>
            {% else %}
            <span class="rounded-2xl border border-gray-100 px-4 py-2 text-sm text-gray-300">Вперёд</span>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
